<!DOCTYPE html>
<html>
    <head>
        <title>Badger Quest : Home Server, Part 3: Docker</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Badger Quest</a></span>
                            </li>
                                                    <li>
                                <span><a href="Badger-Quest_229581.html">Badger Quest</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home-Server_720897.html">Home Server</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Badger Quest : Home Server, Part 3: Docker
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Lauren Barger</span>, last modified on Oct 20, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout fixed-width" data-layout="fixed-width">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p>The home server that I’ll be building will primarily be run using Docker containers. This is for all of the glory that comes with containerised services. In this article we will discuss the installation of Docker, Docker-Compose and Portainer for the true foundation of our home server.</p><h1 id="HomeServer,Part3:Docker-TableofContents">Table of Contents</h1><style type='text/css'>/*<![CDATA[*/
div.rbtoc1668153849596 {padding: 0px;}
div.rbtoc1668153849596 ul {list-style: none;margin-left: 0px;}
div.rbtoc1668153849596 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1668153849596'>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1</span> <a href='#HomeServer,Part3:Docker-Dockerinstallation.'>Docker installation.</a>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1.1</span> <a href='#HomeServer,Part3:Docker-RemoveexistingDockerinstallations.'>Remove existing Docker installations.</a></li>
<li><span class='TOCOutline'>1.2</span> <a href='#HomeServer,Part3:Docker-InstallingDockerEngine.'>Installing Docker Engine.</a>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1.2.1</span> <a href='#HomeServer,Part3:Docker-SetuptheDockerEnginerepository.'>Set up the Docker Engine repository.</a></li>
<li><span class='TOCOutline'>1.2.2</span> <a href='#HomeServer,Part3:Docker-InstallDockerEngine.'>Install Docker Engine.</a></li>
<li><span class='TOCOutline'>1.2.3</span> <a href='#HomeServer,Part3:Docker-Testingyourinstallation.'>Testing your installation.</a></li>
</ul>
</li>
<li><span class='TOCOutline'>1.3</span> <a href='#HomeServer,Part3:Docker-ConfigureDockeruser.'>Configure Docker user.</a></li>
</ul>
</li>
<li><span class='TOCOutline'>2</span> <a href='#HomeServer,Part3:Docker-InstallingPortainer.'>Installing Portainer.</a>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>2.1</span> <a href='#HomeServer,Part3:Docker-CreateaDockerComposefile.'>Create a Docker Compose file.</a></li>
<li><span class='TOCOutline'>2.2</span> <a href='#HomeServer,Part3:Docker-ConfiguringPortainer.'>Configuring Portainer.</a></li>
</ul>
</li>
<li><span class='TOCOutline'>3</span> <a href='#HomeServer,Part3:Docker-Conclusion.'>Conclusion.</a></li>
<li><span class='TOCOutline'>4</span> <a href='#HomeServer,Part3:Docker-References'>References</a></li>
</ul>
</div><h1 id="HomeServer,Part3:Docker-Dockerinstallation.">Docker installation.</h1><p>SSH into your docker installation to begin the installation process. We will be following the official Docker installation instructions for our install <a class="external-link" data-card-appearance="inline" href="https://docs.docker.com/engine/install/ubuntu/" rel="nofollow">https://docs.docker.com/engine/install/ubuntu/</a>.</p><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>In my opinion the most fantastic way to interact with your Docker system is to use the remote shell on VS code: <a class="external-link" data-card-appearance="inline" href="https://www.homeautomationguy.io/home-assistant-tips/using-visual-studio-to-edit-your-home-assistant-configuration-yaml-file-over-ssh/" rel="nofollow">https://www.homeautomationguy.io/home-assistant-tips/using-visual-studio-to-edit-your-home-assistant-configuration-yaml-file-over-ssh/</a>  </p>
</div></div><h2 id="HomeServer,Part3:Docker-RemoveexistingDockerinstallations.">Remove existing Docker installations. </h2><p>Just in case there are old versions of Docker installed on your machine, run the following command to remove them: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get remove docker docker-engine docker.io containerd runc</pre>
</div></div><h2 id="HomeServer,Part3:Docker-InstallingDockerEngine.">Installing Docker Engine.</h2><p>We will be installing the Docker Engine using the repository installation method as advised by Docker. The instructions are as follows: </p><h3 id="HomeServer,Part3:Docker-SetuptheDockerEnginerepository.">Set up the Docker Engine repository.</h3><p>Update the apt packages:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get update</pre>
</div></div><p>Install the packages required for us to download the Docker Engine repository using https: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get install \
   ca-certificates \
   curl \
   gnupg \
   lsb-release</pre>
</div></div><p>Once this has completed, create a directory for the official Docker GPG key and download the key. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</pre>
</div></div><p>Finally, run the following command to download the Docker Engine repository: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">echo \
  &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</pre>
</div></div><h3 id="HomeServer,Part3:Docker-InstallDockerEngine.">Install Docker Engine.</h3><p>Update the apt packages one more time and then install the latest versions of Docker Engine, containerd and Docker Compose. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin</pre>
</div></div><h3 id="HomeServer,Part3:Docker-Testingyourinstallation.">Testing your installation. </h3><p>In order to test that all has been installed correctly, you can spin up the Docker hello world container with the following command: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo docker run hello-world</pre>
</div></div><h2 id="HomeServer,Part3:Docker-ConfigureDockeruser.">Configure Docker user.</h2><p>It would be useful to maintain our Docker environment with our Ubuntu user without needing to use root access for every command. In order to do this, we first need to create a Docker user group: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo groupadd docker</pre>
</div></div><p>Once complete, run the following command to add your Ubuntu user to the Docker user group:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo usermod -aG docker &lt;USER&gt;</pre>
</div></div><p>In order for the changes to take affect, log out and back in again with your user and test with the hello world Docker image without sudo:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">docker run hello-world</pre>
</div></div><p>At this point you have successfully configured Docker and Docker-Compose. In our next step we will create our fist permanent container which will be used to manage our Docker landscape. </p><h1 id="HomeServer,Part3:Docker-InstallingPortainer.">Installing Portainer.</h1><p>Portainer is a GUI for the management of Docker containers, and helpfully runs in it’s own container. </p><h2 id="HomeServer,Part3:Docker-CreateaDockerComposefile.">Create a Docker Compose file.</h2><p>Our Docker environment will be maintained using the <code>/opt</code> directory in our Ubuntu installation. This directory will host our <code>docker-compose.yaml</code> configuration file as well as any additional configuration files required for our Docker containers. </p><p>Navigate to the <code>/opt</code> directory, and create a file called <code>docker-compose.yaml</code>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">cd /opt
sudo nano docker-compose.yaml</pre>
</div></div><p>We will go into more detail regarding Docker compose and configuring our Docker environment, however as a start, we will begin with adding the following information to our configuration file. </p><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>YAML configuration files read indentation in order to parse. Make sure your indentation is consistent when editing this file.</p>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">version: &#39;3.0&#39;

services:
  portainer:
    container_name: portainer
    image: portainer/portainer-ce
    restart: always
    ports:
      - &quot;9000:9000/tcp&quot;
    environment:
      - TZ=Africa/Johannesburg
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /opt/portainer:/data</pre>
</div></div><p>What this configuration does, is first confirm the Docker Compose version that we are running. The services list introduces the set of containers we would like to spin up. In this case, we have only added the container called “portainer” however in future we can expand this list with many more containers. </p><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>For more detail on docker compose service entries, have a look at the following documentation: <a class="external-link" data-card-appearance="inline" href="https://docs.docker.com/compose/compose-file/" rel="nofollow">https://docs.docker.com/compose/compose-file/</a>  </p>
</div></div><p>Once this information has been saved, we’ll use the following command to spin up the containers and apply any changes based on updates to the <code>docker-compose.yaml</code> file.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">docker-compose up -d</pre>
</div></div><p>The -d here means that the new containers will start up in detached mode. </p><h2 id="HomeServer,Part3:Docker-ConfiguringPortainer.">Configuring Portainer.</h2><p>Once the container has completed building, you should now be able to navigate to the container web interface exposed on port 9000: <a class="external-link" href="http://192.168.0.10:9000" rel="nofollow">http://192.168.0.10:9000</a> </p><p>The first time you open Portainer, you will be asked to create a username and password before accessing the interface. Create your credentials and proceed to the next screen. </p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1900552/13631504.png" data-image-src="attachments/1900552/13631504.png" data-height="457" data-width="581" data-unresolved-comment-count="0" data-linked-resource-id="13631504" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20221018-125942.png" data-base-url="https://badgerr.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1900552" data-linked-resource-container-version="8" data-media-id="435577dd-6889-4c4e-b053-7d778f76a32a" data-media-type="file"></span><p>Select the <strong>Local</strong> option followed by <strong>Connect </strong>to start managing the containers on the local server of the Portainer instance.</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1900552/14319645.png" data-image-src="attachments/1900552/14319645.png" data-height="423" data-width="709" data-unresolved-comment-count="0" data-linked-resource-id="14319645" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20221018-130002.png" data-base-url="https://badgerr.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1900552" data-linked-resource-container-version="8" data-media-id="5034ea40-1029-4ef4-b554-cedfdee58154" data-media-type="file"></span><p>You should now see the Portainer interface! You can use this GUI to manage your entire Docker container system. </p><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>For more info on how to use Portainer, you can refer to the Portainer documentation: <a class="external-link" data-card-appearance="inline" href="https://docs.portainer.io/user/home" rel="nofollow">https://docs.portainer.io/user/home</a>  </p>
</div></div><h1 id="HomeServer,Part3:Docker-Conclusion.">Conclusion.</h1><p>In this article, we’ve covered the initial configuration of Docker, Docker-Compose and Portainer for the foundation of our Home Server instance. </p><div class="confluence-information-macro confluence-information-macro-tip"><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>At this point you’ve covered the required work for starting to look through the following additional sections: </p><ul><li><p><a href="Home-Automation_655375.html" data-linked-resource-id="655375" data-linked-resource-version="2" data-linked-resource-type="page">Home Automation</a> </p></li><li><p><a href="Home-Media-Server_1442078.html" data-linked-resource-id="1442078" data-linked-resource-version="1" data-linked-resource-type="page">Home Media Server</a> </p></li></ul></div></div></div>
</div>
</div>
<div class="columnLayout two-equal" data-layout="two-equal">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><strong>←  </strong><a href="14024705.html" data-linked-resource-id="14024705" data-linked-resource-version="7" data-linked-resource-type="page">Home Server, Part 2: Ubuntu OS</a> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p style="text-align: right;"><a href="1212448.html" data-linked-resource-id="1212448" data-linked-resource-version="10" data-linked-resource-type="page">Home Server, Part 4: Docker Networks</a>  <strong>→ </strong> </p></div>
</div>
</div>
<div class="columnLayout fixed-width" data-layout="fixed-width">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="HomeServer,Part3:Docker-References">References</h1><ol><li><p><a class="external-link" data-card-appearance="inline" href="https://www.homeautomationguy.io/home-assistant-tips/installing-docker-home-assistant-and-portainer-on-ubuntu-linux/" rel="nofollow">https://www.homeautomationguy.io/home-assistant-tips/installing-docker-home-assistant-and-portainer-on-ubuntu-linux/</a> </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://docs.docker.com/engine/install/ubuntu/" rel="nofollow">https://docs.docker.com/engine/install/ubuntu/</a> </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://docs.docker.com/compose/compose-file/" rel="nofollow">https://docs.docker.com/compose/compose-file/</a> </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://docs.portainer.io/user/home" rel="nofollow">https://docs.portainer.io/user/home</a> </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://www.homeautomationguy.io/home-assistant-tips/using-visual-studio-to-edit-your-home-assistant-configuration-yaml-file-over-ssh/" rel="nofollow">https://www.homeautomationguy.io/home-assistant-tips/using-visual-studio-to-edit-your-home-assistant-configuration-yaml-file-over-ssh/</a> </p></li></ol><p /></div>
</div>
</div>
</div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1900552/13631504.png">image-20221018-125942.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1900552/14319645.png">image-20221018-130002.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 11, 2022 08:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
