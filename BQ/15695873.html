<!DOCTYPE html>
<html>
    <head>
        <title>Badger Quest : Home Server, Part 8: Scheduled Backups</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Badger Quest</a></span>
                            </li>
                                                    <li>
                                <span><a href="Badger-Quest_229581.html">Badger Quest</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home-Server_720897.html">Home Server</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Badger Quest : Home Server, Part 8: Scheduled Backups
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Lauren Barger</span>, last modified on Oct 24, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout fixed-width" data-layout="fixed-width">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p>I’ve played around with a few backup solutions for the home server and have settled on using GitHub. I’m used to the platform and Git and I think it makes the most sense to keep my versions up to date in the most lightweight way possible.</p><h1 id="HomeServer,Part8:ScheduledBackups-TableofContents">Table of Contents</h1><style type='text/css'>/*<![CDATA[*/
div.rbtoc1668153862533 {padding: 0px;}
div.rbtoc1668153862533 ul {list-style: none;margin-left: 0px;}
div.rbtoc1668153862533 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1668153862533'>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1</span> <a href='#HomeServer,Part8:ScheduledBackups-Creatingscheduledbackups.'>Creating scheduled backups.</a>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1.1</span> <a href='#HomeServer,Part8:ScheduledBackups-Creatingalocalgitrepository.'>Creating a local git repository.</a></li>
<li><span class='TOCOutline'>1.2</span> <a href='#HomeServer,Part8:ScheduledBackups-Creatinga.gitignorefile.'>Creating a .gitignore file.</a></li>
<li><span class='TOCOutline'>1.3</span> <a href='#HomeServer,Part8:ScheduledBackups-Creatingagitcommit/pushshellscript.'>Creating a git commit / push shell script.</a></li>
<li><span class='TOCOutline'>1.4</span> <a href='#HomeServer,Part8:ScheduledBackups-Creatingacronjobtorunthebackupscript.'>Creating a cron job to run the backup script.</a></li>
</ul>
</li>
<li><span class='TOCOutline'>2</span> <a href='#HomeServer,Part8:ScheduledBackups-Conclusion.'>Conclusion.</a></li>
<li><span class='TOCOutline'>3</span> <a href='#HomeServer,Part8:ScheduledBackups-References.'>References.</a></li>
</ul>
</div><h1 id="HomeServer,Part8:ScheduledBackups-Creatingscheduledbackups.">Creating scheduled backups.</h1><p>In order to create scheduled backups, we will require the following: </p><ul><li><p>A GitHub repository to store our backup and a local git repository for pushing our code</p></li><li><p>A gitignore file to manage the files we wish to backup.</p></li><li><p>A shell script with git commit/push commands.</p></li><li><p>A cron job to run the shell script at specific intervals.</p></li></ul><p>The GitHub repository that we’ll be using is <a class="external-link" data-card-appearance="inline" href="https://github.com/TheLaurenBarger/home-server-backup" rel="nofollow">https://github.com/TheLaurenBarger/home-server-backup</a>.</p><h3 id="HomeServer,Part8:ScheduledBackups-Creatingalocalgitrepository.">Creating a local git repository.</h3><p>I’ve already got Git installed, so to create the repository, I simply ran the following commands: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">git config --global user.email &quot;lauren.barger@outlook.com&quot;
git config --global user.name &quot;Badger&quot;

git init
git remote add origin https://github.com/TheLaurenBarger/home-server-backup.git
git push --set-upstream origin master</pre>
</div></div><h3 id="HomeServer,Part8:ScheduledBackups-Creatinga.gitignorefile.">Creating a .gitignore file.</h3><p>The gitignore file you create will depend on your container setup and backup preferences. I chose to exclude specific container configurations from backing up since they wouldn’t be useful in a system restore or require too much space. I created my .gitignore file in the same directory as my docker-compose.yaml file. The .gitignore file I am using currently can be found here: <a class="external-link" data-card-appearance="inline" href="https://github.com/TheLaurenBarger/home-server-backup/blob/master/.gitignore" rel="nofollow">https://github.com/TheLaurenBarger/home-server-backup/blob/master/.gitignore</a> </p><h3 id="HomeServer,Part8:ScheduledBackups-Creatingagitcommit/pushshellscript.">Creating a git commit / push shell script.</h3><p>I used a simple script which adds all the files in the /opt/ directory (my docker-compose environment) to the commit and creates a commit message in the format of “home-server-backup YYYY-MM-DD”. The script is stored in a file called backup.sh and reads as follows <a class="external-link" data-card-appearance="inline" href="https://github.com/TheLaurenBarger/home-server-backup/blob/master/backup.sh" rel="nofollow">https://github.com/TheLaurenBarger/home-server-backup/blob/master/backup.sh</a>: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#!/bin/bash

cd /opt/
timestamp=$(date +%Y-%m-%d)
git add .
git commit -m &quot;home-server-backup $timestamp&quot;
git push origin master</pre>
</div></div><h3 id="HomeServer,Part8:ScheduledBackups-Creatingacronjobtorunthebackupscript.">Creating a cron job to run the backup script.</h3><p>I want this backup script to run every Sunday morning around 5am. To do this my cron expression would be <code>0 5 * * SUN</code>.</p><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>This is a fantastic tool for configuring cron entries: <a class="external-link" data-card-appearance="inline" href="https://crontab.guru" rel="nofollow">https://crontab.guru</a>  </p>
</div></div><p>To create the cron entry, execute the following command: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo crontab -e</pre>
</div></div><p>and add the following entry after the file comments: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence"># Edit this file to introduce tasks to be run by cron.
# 
# Each task to run has to be defined through a single line
# indicating with different fields when the task will be run
# and what command to run for the task
# 
# To define the time you can provide concrete values for
# minute (m), hour (h), day of month (dom), month (mon),
# and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).
# 
# Notice that tasks will be started based on the cron&#39;s system
# daemon&#39;s notion of time and timezones.
# 
# Output of the crontab jobs (including errors) is sent through
# email to the user the crontab file belongs to (unless redirected).
# 
# For example, you can run a backup of all your user accounts
# at 5 a.m every week with:
# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
# 
# For more information see the manual pages of crontab(5) and cron(8)
# 
# m h  dom mon dow   command
0 5 * * SUN /opt/backup.sh</pre>
</div></div><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>It is actually super important to put these commands in the sudo’s crontab. That way you won’t ever run into the permissions issues that your own user will have regarding updates and backups</p>
</div></div><h1 id="HomeServer,Part8:ScheduledBackups-Conclusion.">Conclusion.</h1><p>I now have a scheduled script which will backup my docker compose environment to GitHub every Sunday morning at 5am.</p></div>
</div>
</div>
<div class="columnLayout two-equal" data-layout="two-equal">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><strong>←  </strong><a href="4292609.html" data-linked-resource-id="4292609" data-linked-resource-version="9" data-linked-resource-type="page">Home Server, Part 7: Mikrotik Port Forwarding Secure Ports</a> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p style="text-align: right;"><a href="17924097.html" data-linked-resource-id="17924097" data-linked-resource-version="2" data-linked-resource-type="page">Home Server, Part 9: Scheduled Updates</a> → <strong> </strong> </p></div>
</div>
</div>
<div class="columnLayout fixed-width" data-layout="fixed-width">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="HomeServer,Part8:ScheduledBackups-References.">References.</h1><ol><li><p><a class="external-link" data-card-appearance="inline" href="https://crontab.guru" rel="nofollow">https://crontab.guru</a> </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://www.homeautomationguy.io/home-assistant-tips/keeping-your-home-assistant-container-up-to-date/" rel="nofollow">https://www.homeautomationguy.io/home-assistant-tips/keeping-your-home-assistant-container-up-to-date/</a>  </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://askubuntu.com/questions/173924/how-to-run-a-cron-job-using-the-sudo-command" rel="nofollow">https://askubuntu.com/questions/173924/how-to-run-a-cron-job-using-the-sudo-command</a>  </p></li></ol><p /></div>
</div>
</div>
</div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695890.png">image-20220824-135836.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695893.png">image-20220824-073749.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695896.png">image-20220824-073716.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695899.png">image-20220824-073600.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695902.png">image-20220824-073531.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695905.png">image-20220824-073153.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695908.png">image-20220824-073135.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695911.png">image-20220824-072719.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695914.png">image-20220824-072603.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695917.png">image-20220824-071639.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695920.png">image-20220824-071403.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695923.png">Picture1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695926.png">image-20220824-065900.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695929.png">image-20220824-065144.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695932.png">image-20220824-062900.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695935.png">image-20220824-062711.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695938.png">image-20220824-062557.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695941.png">image-20220824-061720.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695944.png">image-20220824-061657.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695947.png">image-20220824-061439.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695950.png">image-20220824-055924.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695953.png">image-20220823-151507.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695956.png">image-20220823-151304.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695959.png">image-20220823-144050.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15695873/15695962.png">image-20220823-143720.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 11, 2022 08:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
