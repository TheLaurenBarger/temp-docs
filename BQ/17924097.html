<!DOCTYPE html>
<html>
    <head>
        <title>Badger Quest : Home Server, Part 9: Scheduled Updates</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Badger Quest</a></span>
                            </li>
                                                    <li>
                                <span><a href="Badger-Quest_229581.html">Badger Quest</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home-Server_720897.html">Home Server</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Badger Quest : Home Server, Part 9: Scheduled Updates
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Lauren Barger</span>, last modified on Oct 24, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout fixed-width" data-layout="fixed-width">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p>Since we are running home assistant via docker containers, we are responsible for maintaining and updating the containers on our server. But since responsibility is fairly high on my list of things to automate, we’re going to parse it off to a cron job instead. </p><h1 id="HomeServer,Part9:ScheduledUpdates-TableofContents">Table of Contents</h1><style type='text/css'>/*<![CDATA[*/
div.rbtoc1668153867387 {padding: 0px;}
div.rbtoc1668153867387 ul {list-style: none;margin-left: 0px;}
div.rbtoc1668153867387 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1668153867387'>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1</span> <a href='#HomeServer,Part9:ScheduledUpdates-Creatingscheduledbackups.'>Creating scheduled backups.</a>
<ul class='toc-indentation'>
<li><span class='TOCOutline'>1.1</span> <a href='#HomeServer,Part9:ScheduledUpdates-Creatinganupdatebashscript.'>Creating an update bash script.</a></li>
<li><span class='TOCOutline'>1.2</span> <a href='#HomeServer,Part9:ScheduledUpdates-Creatingacronjobtorunthebackupscript.'>Creating a cron job to run the backup script.</a></li>
</ul>
</li>
<li><span class='TOCOutline'>2</span> <a href='#HomeServer,Part9:ScheduledUpdates-Conclusion.'>Conclusion.</a></li>
<li><span class='TOCOutline'>3</span> <a href='#HomeServer,Part9:ScheduledUpdates-References.'>References.</a></li>
</ul>
</div><h1 id="HomeServer,Part9:ScheduledUpdates-Creatingscheduledbackups.">Creating scheduled backups.</h1><p>In order to create scheduled updates, we will require the following: </p><ul><li><p>A nifty bash script</p></li><li><p>A cron job to run the shell script at specific intervals.</p></li></ul><h3 id="HomeServer,Part9:ScheduledUpdates-Creatinganupdatebashscript.">Creating an update bash script.</h3><p>I used a simple script which will first update my Ubuntu environment and will then pull any updates to my docker containers before installing the updates and pruning any unused images or volumes <a class="external-link" data-card-appearance="inline" href="https://github.com/TheLaurenBarger/home-server-backup/blob/master/update.sh" rel="nofollow">https://github.com/TheLaurenBarger/home-server-backup/blob/master/update.sh</a>: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#!/bin/bash
cd /opt/
apt update
apt full-upgrade -y
apt autoremove -y

docker-compose pull
docker-compose up -d 
docker image prune -af 
docker volume prune -f </pre>
</div></div><h3 id="HomeServer,Part9:ScheduledUpdates-Creatingacronjobtorunthebackupscript.">Creating a cron job to run the backup script.</h3><p>I want this update script to run every Sunday morning, after the backup script has run at 5.30am. To do this my cron expression would be <code>30 5 * * SUN</code>.</p><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>This is a fantastic tool for configuring cron entries: <a class="external-link" data-card-appearance="inline" href="https://crontab.guru" rel="nofollow">https://crontab.guru</a>  </p>
</div></div><p>To create the cron entry, execute the following command: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo crontab -e</pre>
</div></div><p>and add the following entry after the file comments: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence"># Edit this file to introduce tasks to be run by cron.
# 
# Each task to run has to be defined through a single line
# indicating with different fields when the task will be run
# and what command to run for the task
# 
# To define the time you can provide concrete values for
# minute (m), hour (h), day of month (dom), month (mon),
# and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).
# 
# Notice that tasks will be started based on the cron&#39;s system
# daemon&#39;s notion of time and timezones.
# 
# Output of the crontab jobs (including errors) is sent through
# email to the user the crontab file belongs to (unless redirected).
# 
# For example, you can run a backup of all your user accounts
# at 5 a.m every week with:
# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
# 
# For more information see the manual pages of crontab(5) and cron(8)
# 
# m h  dom mon dow   command
0 5 * * SUN /opt/backup.sh
30 5 * * SUN /opt/update.sh</pre>
</div></div><div class="panel" style="background-color: #EAE6FF;border-color: #998DD9;border-width: 1px;"><div class="panelContent" style="background-color: #EAE6FF;">
<p>It is actually super important to put these commands in the sudo’s crontab. That way you won’t ever run into the permissions issues that your own user will have regarding updates and backups</p>
</div></div><h1 id="HomeServer,Part9:ScheduledUpdates-Conclusion.">Conclusion.</h1><p>I now have a scheduled script which will update my Ubuntu and docker compose environment every Sunday morning at 5.30am.</p></div>
</div>
</div>
<div class="columnLayout two-equal" data-layout="two-equal">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><strong>←</strong><a href="15695873.html" data-linked-resource-id="15695873" data-linked-resource-version="4" data-linked-resource-type="page">Home Server, Part 8: Scheduled Backups</a> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p style="text-align: right;"><strong> </strong> </p></div>
</div>
</div>
<div class="columnLayout fixed-width" data-layout="fixed-width">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="HomeServer,Part9:ScheduledUpdates-References.">References.</h1><ol><li><p><a class="external-link" data-card-appearance="inline" href="https://crontab.guru" rel="nofollow">https://crontab.guru</a> </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://www.homeautomationguy.io/home-assistant-tips/keeping-your-home-assistant-container-up-to-date/" rel="nofollow">https://www.homeautomationguy.io/home-assistant-tips/keeping-your-home-assistant-container-up-to-date/</a>  </p></li><li><p><a class="external-link" data-card-appearance="inline" href="https://askubuntu.com/questions/173924/how-to-run-a-cron-job-using-the-sudo-command" rel="nofollow">https://askubuntu.com/questions/173924/how-to-run-a-cron-job-using-the-sudo-command</a>  </p></li></ol><p /></div>
</div>
</div>
</div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924114.png">image-20220823-143720.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924117.png">image-20220823-144050.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924120.png">image-20220823-151304.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924123.png">image-20220823-151507.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924126.png">image-20220824-055924.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924129.png">image-20220824-061439.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924132.png">image-20220824-061657.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924135.png">image-20220824-061720.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924138.png">image-20220824-062557.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924141.png">image-20220824-062711.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924144.png">image-20220824-062900.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924147.png">image-20220824-065144.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924150.png">image-20220824-065900.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924153.png">Picture1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924156.png">image-20220824-071403.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924159.png">image-20220824-071639.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924162.png">image-20220824-072603.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924165.png">image-20220824-072719.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924168.png">image-20220824-073135.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924171.png">image-20220824-073153.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924174.png">image-20220824-073531.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924177.png">image-20220824-073600.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924180.png">image-20220824-073716.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924183.png">image-20220824-073749.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/17924097/17924186.png">image-20220824-135836.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 11, 2022 08:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
